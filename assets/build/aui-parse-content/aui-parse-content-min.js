YUI.add("aui-parse-content",function(e,t){var n=e.Lang,r=n.isString,i=e.config.doc,s="append",o="documentElement",u="firstChild",a="head",f="host",l="innerHTML",c="ParseContent",h="queue",p="script",d=";",v="src",m={"":1,"text/javascript":1},g=e.Component.create({NAME:c,NS:c,ATTRS:{queue:{value:null}},EXTENDS:e.Plugin.Base,prototype:{initializer:function(){var t=this;g.superclass.initializer.apply(this,arguments),t.set(h,new e.AsyncQueue),t._bindAOP()},globalEval:function(t){var r=e.getDoc(),s=r.one(a)||r.get(o),u=i.createElement(p);u.type="text/javascript",t&&(u.text=n.trim(t)),s.appendChild(u).remove()},parseContent:function(e){var t=this,n=t._clean(e);return t._dispatch(n),n},_addInlineScript:function(e){var t=this;t.get(h).add({args:e,context:t,fn:t.globalEval,timeout:0})},_bindAOP:function(){var t=this,n=function(n){var r=Array.prototype.slice.call(arguments),i=t.parseContent(n);return r.splice(0,1,i.fragment),new e.Do.AlterArgs(null,r)};this.doBefore("insert",n),this.doBefore("replaceChild",n);var r=function(n){var r=t.parseContent(n);return new e.Do.AlterArgs(null,[r.fragment])};this.doBefore("replace",r),this.doBefore("setContent",r)},_clean:function(t){var n={},i=e.Node.create("<div></div>");return i.append("<div>_</div>"),r(t)?e.DOM.addHTML(i,t,s):i.append(t),n.js=i.all(p).filter(function(e){return m[e.getAttribute("type").toLowerCase()]}),n.js.each(function(e,t){e.remove()}),i.get(u).remove(),n.fragment=i.get("childNodes").toFrag(),n},_dispatch:function(t){var n=this,r=n.get(h),i=[];t.js.each(function(t,s){var o=t.get(v);if(o)i.length&&(n._addInlineScript(i.join(d)),i.length=0),r.add({autoContinue:!1,fn:function(){e.Get.script(o,{onEnd:function(e){e.purge(),r.run()}})},timeout:0});else{var u=t._node;i.push(u.text||u.textContent||u.innerHTML||"")}}),i.length&&n._addInlineScript(i.join(d)),r.run()}}});e.namespace("Plugin").ParseContent=g},"2.0.0pr5",{requires:["async-queue","plugin","io-base","aui-component","aui-node-base"]});
